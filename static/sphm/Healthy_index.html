<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>智能运营SOAM平台2.0</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">  
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <link href="css/style.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/jquery.page.css" type="text/css">

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript" src="js/echarts.min.js"></script>
    <script type="text/javascript" src="js/jquery.page.js"></script>
    <script src="layer/layer.js" type="text/javascript"></script>
</head>
<body>
    <div class="container" style="height:1030px;margin-top:30px;">
        <div class="pl_r30">
            <div class="column_4 zl_t">
                <div><img src="images/ico.png" /><p>健康度</p><i style="color: rgb(112, 192, 128);">0°H</i></div>
                <div><img src="images/ico1.png" /><p>工单完结率</p><i style="color: rgb(208, 105, 96);">0%</i></div>
                <div><img src="images/ico3.png" /><p>预警准确率</p><i style="color: rgb(208, 105, 96);">0%</i></div>
                <div><img src="images/ico4.png" /><p>MTBF</p><i style="color: rgb(233, 199, 92);">0</i></div>
            </div>
            <div class="column_3_chart mt15 clearfix">
                <div class="box">
                    <h1>各风场健康情况</h1>
                    <div id="chart_1" class="border" style="height:400px;"></div>
                </div>
                <div class="box ml15" style="position:relative;">
                    <h1>各风场预警概况</h1>
                    <div id="chart_2" class="border" style="height:400px;"></div>
                </div>
                <div class="box ml15" id="jryh">
                    <h1 style="cursor:pointer;">今日风机隐患<button type="button">总览</button></h1>
                    <div class="border list_r4_c3" style="height:400px;">
                        <ul class="clearfix">
                            <li class="c_1">风场</li>
                            <li class="c_1">机组</li>
                            <li class="c_2">隐患名称</li>
                            <li class="c_1">等级</li>
                        </ul>
                        <div class="jryh_list">
                        </div>
                    </div>
                </div>
            </div>
            <div class="column_4_chart mt15 yjtj clearfix">
                <div class="box">
                    <h1 onclick="location.href = 'yj_index.html?op=1';">预警接收统计</h1>
                    <div class="border">
                        <div id="chart_3" style="height:350px;"></div>
                        <div class="top3"><a>总数TOP3</a></div>
                    </div>
                </div>
                <div class="box ml15">
                    <h1 onclick="location.href = 'yj_index.html?op=1';">预警处理统计</h1>
                    <div class="border">
                        <div id="chart_4" style="height:350px;"></div>
                        <div class="top3"><a>审核TOP3</a></div>
                    </div>
                </div>
                <div class="box ml15">
                    <h1 onclick="location.href = 'yj_index.html?op=2';">故障派工统计</h1>
                    <div class="border">
                        <div id="chart_5" style="height:350px;"></div>
                        <div class="top3"><a>派工TOP3</a></div>
                    </div>
                </div>
                <div class="box ml15">
                    <h1 onclick="location.href = 'yj_index.html?op=2';">任务执行统计</h1>
                    <div class="border">
                        <div id="chart_6" style="height:350px;"></div>
                        <div class="top3"><a>执行TOP3</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog" id="dialog_1">
        <div class="opacity"></div>
        <div class="content">
            <a class="close"></a>
            <h1>巴盟 各风场 健康度<i class="zl_btn">总览</i></h1>
            <div class="chart_bg">
                <div id="dialog_1_chart_1" style="height:350px;"></div>
            </div>
            <div class="clearfix mt15">
                <div class="left" style="width:1000px;">
                    <h1></h1>
                    <div class="chart_bg">
                        <div id="dialog_1_chart_2" style="height:350px;"></div>
                    </div>
                </div>
                <div class="right" style="width:385px;">
                    <h1>健康度对比图</h1>
                    <div class="chart_bg">
                        <div class="scroll" style="height:350px;overflow:auto;padding:20px 40px">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog" id="dialog_2">
        <div class="opacity"></div>
        <div class="content">
            <a class="close"></a>
            <h1>巴盟 各风场 完结率<i class="zl_btn">总览</i></h1>
            <div class="chart_bg">
                <div id="dialog_2_chart_1" style="height:350px;"></div>
            </div>
            <div class="clearfix mt15">
                <div class="left" style="width:1000px;">
                    <h1>2016年1月-11月 风场一 完结率</h1>
                    <div class="chart_bg">
                        <div id="dialog_2_chart_2" style="height:350px;"></div>
                    </div>
                </div>
                <div class="right" style="width:385px;">
                    <h1>完结率对比图</h1>
                    <div class="chart_bg">
                        <div class="scroll" style="height:350px;overflow:auto;padding:20px 40px">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog" id="dialog_3">
        <div class="opacity"></div>
        <div class="content">
            <a class="close"></a>
            <h1>巴盟 各风场 预警准确率<i class="zl_btn">总览</i></h1>
            <div class="chart_bg">
                <div id="dialog_3_chart_1" style="height:350px;"></div>
            </div>
            <div class="clearfix mt15">
                <div class="left" style="width:1000px;">
                    <h1></h1>
                    <div class="chart_bg">
                        <div id="dialog_3_chart_2" style="height:350px;"></div>
                    </div>
                </div>
                <div class="right" style="width:385px;">
                    <h1>准确率对比图</h1>
                    <div class="chart_bg">
                        <div class="scroll" style="height:350px;overflow:auto;padding:20px 40px">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog" id="dialog_4">
        <div class="opacity"></div>
        <div class="content">
            <a class="close"></a>
            <h1>前12个月 MTBF 对比变化趋势</h1>
			<div class="chart_bg mtbf">
				<ul class="clearfix">
					
				</ul>
			</div>
            <div class="chart_bg">
                <div id="dialog_4_chart_1" style="height:550px;"></div>
            </div>
        </div>
    </div>
    <div class="dialog jryh_dialog" id="dialog_5">
		<div class="opacity"></div>
        <div class="content">
            <a class="close"></a>
			<div class="clearfix">
				<div class="radius">
					<div class="item">
						<h2>0</h2>
						<p>今日预警总数</p>
					</div>
					<div class="item">
						<h2>0</h2>
						<p>预警风场</p>
					</div>
					<div class="item">
						<h2>0</h2>
						<p>预警风机</p>
					</div>
				</div>
                <div class="left ml15" style="width:623px;">
                    <h1>巴盟  各风场  隐患明细</h1>
                    <div class="chart_bg">
                        <div id="dialog_5_chart_1" style="height:365px;"></div>
                    </div>
                </div>
                <div class="left ml15" style="width:622px;">
                    <h1>巴盟  各风场  不同机型  隐患明细</h1>
                    <div class="chart_bg">
                        <div id="dialog_5_chart_2" style="height:365px;"></div>
                    </div>
                </div>
			</div>
			<div class="clearfix mt15">
                <div class="left" style="width:900px;">
                    <h1>明细列表</h1>
					<div class="chart_bg">
						<div class="yhmx_list_box" style="height:315px;">
							<ul class="clearfix">
								<li class="c_1">序号</li>
								<li class="c_1">区域</li>
								<li class="c_2">风电场</li>
								<li class="c_1">机组</li>
								<li class="c_2">隐患明细</li>
								<li class="c_1">等级</li>
							</ul>
							<div id="yhmx_list">
								
							</div>
						</div>
						<div id="page"></div>
					</div>
                </div>
                <div class="left ml15" style="width:485px;">
                    <h1>隐患等级分布</h1>
                    <div class="chart_bg">
                        <div id="dialog_5_chart_3" style="height:365px;"></div>
                    </div>
                </div>
			</div>
		</div>
	</div>
    <script src="js/mychart.js"></script>
    <script>
        //弹出
        $(function () {

            LoginJFPage(function () {
                //预警接收
                yjjstj();
                //预警处理统计
                yjcltj('/main_getAlarmSupport.action', 'chart_4', 1);
                //故障派工统计
                yjcltj('/main_getDispatchJob.action', 'chart_5', 2);
                //任务执行统计
                rwzxtj();
                //今日风机隐患
                jrfjyh_index();

                //工单完结率
                gdwjl_top();
                //各风场预警概况
                yjgk_index();
            })

            LoginPage(function () {
                //健康总览
                jkzl_index();
                fc_zql_get();

                //mtfb
                mtbf_get();
            })

            $(".zl_t > div:eq(0),#chart_1,#dialog_1 .zl_btn").click(function () {
                $("#dialog_1").show();
                $("#dialog_1 .zl_btn").removeClass("noColor");
                $("#dialog_1 .left h1").text(now.getFullYear() + '年1月-' + (now.getMonth() + 1) + '月 巴盟 各风场 健康度');
                //健康总览
                jkzl();
            })


            $(".zl_t > div:eq(1),#chart_2,#dialog_2 .zl_btn").click(function () {
                $("#dialog_2").show();
                $("#dialog_2 .zl_btn").removeClass("noColor");
                $("#dialog_2 .left h1").text(now.getFullYear() + '年1月-' + (now.getMonth() + 1) + '月 巴盟 各风场 完结率');
                //完结率
                fc_wjl();
            })


            $(".zl_t > div:eq(2),#dialog_3 .zl_btn").click(function () {
                $("#dialog_3").show();
                $("#dialog_3 .zl_btn").removeClass("noColor");
                $("#dialog_3 .left h1").text(now.getFullYear() + '年1月-' + (now.getMonth() + 1) + '月 巴盟 每月 准确率');

                fc_zql();
            })

            $(".zl_t > div:eq(3)").click(function () {
                $("#dialog_4").show();
                mtbf();
            })

            $("#jryh h1 button").click(function () {
                $("#page").html('')
                $("#dialog_5").show();

                var nowDate = getDay();

                //获取今日预警总数
                var index_3 = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
                $.ajax({
                    type: "post",
                    url: window.JFApiDomian + '/main_getAlarmTotal.action?beginTime=' + nowDate + ' 00:00:00&endTime=' + nowDate+' 23:59:59',
                    cache: false,
                    dataType: 'jsonp',
                    complete: function () {
                        layer.close(index_3);
                    },
                    success: function (json) {
                        $(".jryh_dialog .radius .item:eq(0) h2").text(json.data.data);
                    },
                    error: function () {
                        alert('载入数据失败！');
                    }
                });
                //获取今日预警总数
                var index_4 = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
                $.ajax({
                    type: "post",
                    url: window.JFApiDomian + '/main_getAlarmWFTotal.action?beginTime=' + nowDate + ' 00:00:00&endTime=' + nowDate + ' 23:59:59',
                    cache: false,
                    dataType: 'jsonp',
                    complete: function () {
                        layer.close(index_4);
                    },
                    success: function (json) {
                        $(".jryh_dialog .radius .item:eq(1) h2").text(json.data.data);
                    },
                    error: function () {
                        alert('载入数据失败！');
                    }
                });
                var index_5 = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
                $.ajax({
                    type: "post",
                    url: window.JFApiDomian + '/main_getAlarmWTTotal.action?beginTime=' + nowDate + ' 00:00:00&endTime=' + nowDate + ' 23:59:59',
                    cache: false,
                    dataType: 'jsonp',
                    complete: function () {
                        layer.close(index_5);
                    },
                    success: function (json) {
                        $(".jryh_dialog .radius .item:eq(2) h2").text(json.data.data);
                    },
                    error: function () {
                        alert('载入数据失败！');
                    }
                });

                $.ajax({
                    type: "post",
                    url: window.JFApiDomian + '/main_getWfAlarmInfoByWtType.action?beginTime=' + nowDate + ' 00:00:00&endTime=' + nowDate + ' 23:59:59&areaId=201409110342501',
                    cache: false,
                    dataType: 'jsonp',
                    success: function (json) {
                        json_yjgk = json;
                        var xAxisData = new Array();
                        var seriesData = new Array();
                        for (var o in json.listData) {
                            xAxisData.push(json.listData[o].dicsName);
                            seriesData.push(json.listData[o].areaAlarmCount);
                        }
                        option = BarOption('↑', xAxisData, '隐患数', seriesData, "mousemove");

                        var myChart = echarts.init(document.getElementById('dialog_5_chart_1'));
                        myChart.setOption(option);
                    }
                })

                loadPage(1);

                //各风场 不同机型 隐患明细
                var index_2 = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
                $.ajax({
                    type: "post",
                    url: window.JFApiDomian + '/main_getAllWtTypeAlarmInfo.action?beginTime=' + nowDate + ' 00:00:00&endTime=' + nowDate + ' 23:59:59',
                    cache: false,
                    dataType: 'jsonp',
                    complete: function () {
                        layer.close(index_2);
                    },
                    success: function (json) {
                        var yAxisData = new Array();
                        var seriesData = new Array();
                        for (var o in json.listData) {
                            if (json.listData[o].name == 'X') {
                                for (var t in json.listData[o].data) {
                                    yAxisData.push(json.listData[o].data[t].wtTypeName);
                                    seriesData.push(json.listData[o].data[t].alarmCount);
                                }
                            }
                        }

                        option = BarOption_2('↑', yAxisData, '隐患数', seriesData, "mousemove");

                        var myChart = echarts.init(document.getElementById('dialog_5_chart_2'));
                        myChart.setOption(option);
                    },
                    error: function () {
                        alert('载入数据失败！');
                    }
                });

                //隐患等级分布
                var index_1 = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
                $.ajax({
                    type: "post",
                    url: window.JFApiDomian + '/main_getGradeByWtType.action?beginTime=' + nowDate + ' 00:00:00&endTime=' + nowDate+' 23:59:59',
                    cache: false,
                    dataType: 'jsonp',
                    complete: function () {
                        layer.close(index_1);
                    },
                    success: function (json) {
                        var yAxisData = new Array();
                        var seriesData = new Array();
                        for (var o in json.listData) {
                            yAxisData.push(json.listData[o].alarmGrade_CN);
                            seriesData.push({ value: json.listData[o].count, name: json.listData[o].alarmGrade_CN });
                        }
                        option = Pie_hollow(yAxisData, seriesData);

                        var myChart = echarts.init(document.getElementById('dialog_5_chart_3'));
                        myChart.setOption(option);

                    },
                    error: function () {
                        alert('载入数据失败！');
                    }
                });
            })
        })

        function loadPage(pageIndex) {
            var page_layer = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
            var nday = getDay();
            $.ajax({
                type: "post",
                url: window.JFApiDomian + '/alarmInfo_searchWorkPub.do?pageid=' + pageIndex + '&pagecount=5&userId=' + userId + '&beginTime=' + nday + ' 00:00:00&endTime=' + nday+" 23:59:59&userid="+userId,
                cache: false,
                dataType: 'jsonp',
                complete: function () {
                    layer.close(page_layer);
                },
                success: function (json) {
                    if (pageIndex == json.pagination.pageNo) {
                        $("#yhmx_list").html('');
                        for (var i = 0; i < json.pagination.list.length; i++) {
                            $("#yhmx_list").append('<ul class="clearfix"><li class="c_1">' + ((pageIndex-1)*5+i+1) + '</li><li class="c_1">' + json.pagination.list[i].proName + '</li><li class="c_2">' + json.pagination.list[i].wfName + '</li><li class="c_1">' + json.pagination.list[i].wtName + '</li><li class="c_2">' + json.pagination.list[i].alarmName_CN + '</li><li class="c_1">' + json.pagination.list[i].alarmGrade_CN + '</li></ul>');
                        }
                    }
                    if ($("#page").text() == '') {
                        $("#page").Page({
                            totalPages: json.pagination.totalPage,
                            liNums: 7,
                            activeClass: 'activP',
                            callBack: function (page) {
                                loadPage(page);
                            }
                        });
                    }
                },
                error: function () {
                    alert('载入数据失败！');
                }
            });
        }
    </script>
</body>
</html>