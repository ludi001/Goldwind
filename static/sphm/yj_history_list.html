<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>智能运营SOAM平台2.0</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">  
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <link href="css/style.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/jquery.page.css" type="text/css">

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript" src="js/jquery.page.js"></script>
	<script type="text/javascript" src="laydate/laydate.js"></script>
    <script src="layer/layer.js" type="text/javascript"></script>
    <style>
        #jx_detail .grid td {
            min-width: inherit;
        }
    </style>
</head>
<body>
    <div class="container history_list">
		<div class="search">
			<div class="right_btn">
				<button type="button">查询</button>
				<button class="export" type="button">数据导出</button>
			</div>
			<div class="box">
				<div class="wrap">
					<label>工作编号</label>
					<input type="text" name="workcode" class="txt" id="workcode" />
					<label class="ml15">执行单编号</label>
					<input type="text" name="zxdcode" class="txt" id="zxdcode" />
					<label class="ml15">处理状态</label>
					<span class="tab" id="cl_status">
						<input type="button" class="active" value="全部" />
						<input type="button" value="未处理" />
						<input type="button" value="处理中" />
						<input type="button" value="处理完成" />
					</span>
					<label class="ml15">审核状态</label>
					<span class="tab" id="sh_status">
						<input type="button" class="active" value="全部" />
						<input type="button" key="0" value="待审核" />
						<input type="button" key="2" value="待派工" />
						<input type="button" key="3" value="执行中" />
						<input type="button" key="4" value="已结项" />
						<input type="button" key="1" value="已回退" />
					</span>
				</div>
				<div class="wrap">
					<label>预警时间</label>
					<span class="tab" id="yj_time">
						<input type="button" class="active" value="全部" />
						<input type="button" value="今天" />
						<input type="button" value="昨天" />
						<input type="button" value="近一周" />
						<input type="button" value="本月" />
						<input type="button" value="本年" />
					</span>
					<input type="text" name="begindate" class="txt date" id="begindate" /> - <input type="text" name="enddate" class="txt date" id="enddate" />
					<label class="ml15">等级</label>
					<span class="tab" id="level">
						<input type="button" class="active" value="全部" />
						<input type="button" key="level_1" value="1级" />
						<input type="button" key="level_2" value="2级" />
						<input type="button" key="level_3" value="3级" />
						<input type="button" key="level_4" value="4级" />
						<input type="button" key="level_5" value="5级" />
					</span>
				</div>
				<div class="wrap"><form class="form">
					<label>预警来源</label>
					<select id="yj_source" name="yj_source">
						<option selected="" value="">请选择</option>
						<option value="0">金风智能预警</option>
						<option value="1">巡检发现异常</option>
						<option value="2">生产系统预警</option>
						<option value="3">检测报告预警</option>
					</select>
					<span class="ml15">隐患点</span>
					<select id="yhd" name="yhd">
						<option value="">请选择</option>
					</select>
					<span class="ml15">风场</span>
					<select id="wfName" name="wfName" onchange="bindWT()">
						<option value="">请选择</option>
					</select>
					<span class="ml15">机组</span>
					<select id="wtName" name="wtName">
						<option value="">请选择</option>
					</select>
					<span class="ml15">准确度</span>
					<span class="tab" id="zqd">
						<input type="button" class="active" value="全部" />
						<input type="button" key="2" value="1星" />
						<input type="button" key="4" value="2星" />
						<input type="button" key="6" value="3星" />
						<input type="button" key="8" value="4星" />
						<input type="button" key="10" value="5星" />
					</span></form>
				</div>
			</div>
		</div>
		<table class="grid" border="0" border-collapse="0" border-spacing="0">
			<thead>
				<tr>
					<td style="width:50px;">&nbsp;</td>
					<td>预警时间</td>
					<td>区域</td>
					<td>风场</td>
					<td>机组</td>
					<td>隐患点</td>
					<td>等级</td>
					<td>处理方案</td>
					<td>状态</td>
					<td>流程</td>
					<td>准确</td>
					<td>执行单编号</td>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
		<div id="page" class="pt15"></div>
	</div>

    <div class="dialog yj_form" id="dialog_1">
        <div class="opacity" style="z-index:9991;"></div>
        <div class="content" style="width:600px;margin-left:-300px;z-index:9992;">
            <a class="close"></a>
            <h1>审核回退</h1>
            <form id="ht_form">
                <dl class="clearfix">
                    <dt>回退理由</dt>
                    <dd>
                        <select id="reason" name="reason" datatype="Require" msg="请选择回退理由">
                            <option value="">请选择</option>
                            <option value="数据不准确">数据不准确</option>
                            <option value="轻微故障，暂不处理">轻微故障，暂不处理</option>
                            <option value="预警过晚，已完成处理">预警过晚，已完成处理</option>
                        </select>
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>备注</dt>
                    <dd><textarea name="ht_remark" id="ht_remark"></textarea></dd>
                </dl>
                <div class="btn">
                    <button type="button" class="cancle" for="dialog_1">取消</button>
                    <button type="button" class="ml15 submitBtn" onclick="huitui()">确认</button>
                </div>
            </form>
        </div>
    </div>

    <div class="dialog yj_form" id="dialog_3">
        <div class="opacity" style="z-index:9991;"></div>
        <div class="content" style="width:600px;margin-left:-300px;z-index:9992;">
            <a class="close"></a>
            <h1>派工（故障告知单）</h1>
            <form id="pg_form">
                <input type="hidden" id="pg_wtid" />
                <dl class="clearfix">
                    <dt>工单编号</dt>
                    <dd>
                        <input type="text" class="txt" id="pg_workID" name="pg_workID" readonly="readonly" style="width: 380px;" value="" />
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>预警时间</dt>
                    <dd>
                        <input type="text" class="txt" id="pg_yjTime" name="pg_yjTime" readonly="readonly" style="width: 380px;" value="" />
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>来源</dt>
                    <dd>
                        <select id="pg_source" name="pg_source" disabled="disabled"></select>
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>风场名称</dt>
                    <dd>
                        <select id="pg_wfName" name="pg_wfName" disabled="disabled"></select>
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>机组名称</dt>
                    <dd>
                        <select id="pg_wtName" name="pg_wtName" disabled="disabled"></select>
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>隐患名称</dt>
                    <dd>
                        <select id="pg_yhd" name="pg_yhd" disabled="disabled"></select>
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>预警级别</dt>
                    <dd>
                        <select id="pg_level" name="pg_level" disabled="disabled"></select>
                    </dd>
                </dl>
                <dl class="clearfix">
                    <dt>备注</dt>
                    <dd><textarea name="pg_remark" id="pg_remark"></textarea></dd>
                </dl>
                <div class="btn">
                    <button type="button" class="cancle" for="dialog_3">取消</button>
                    <button type="button" class="ml15 submitBtn" onclick="paigong()">提交派工</button>
                </div>
            </form>
        </div>
    </div>
    <div class="dialog gd_detail">
        <div class="opacity"></div>
        <div class="content" style="width:1000px;margin-left:-500px;">
            <a class="close"></a>
            <h1><label></label><span>结项</span><span>审核退回</span><span>开始派工</span></h1>
            <div class="scroll" style="height:600px;overflow:auto;">
                <div class="wrap">
                    <label>状态</label><span></span>
                    <label>流程</label><span></span>
                    <label>隐患点</label><span></span>
                    <label>预警等级</label><span></span>
                </div>
                <div class="wrap">
                    <label>区域</label><span></span>
                    <label>风电场</label><span></span>
                    <label>机组</label><span></span>
                    <label>预警时间</label><span></span>
                </div>
                <div class="wrap">
                    <label>处理时间</label><span></span>
                    <label>处理结果</label><span></span>
                    <label>预警准确度</label><span class='x'>&nbsp;<p></p></span>
                </div>
                <div class="wrap">
                    <label>备注</label>
                    <div class="mul_text">
                    </div>
                </div>
                <div class="wrap">
                    <label>系统推荐处理方案</label>
                    <div class="mul_text">

                    </div>
                </div>
                <div class="wrap">
                    <label>推荐专家</label>
                    <div class="zj clearfix">
                        <div class="item">
                            <img src="images/user/1.png" />
                            <h2>黄鹤</h2>
                            <h3>Tel：17743115900</h3>
                            <p>事业部调度工程师，2年现场维护经验，2年现场调度经验，擅长处理控制柜温度异常、变桨电机异常等预警</p>
                        </div>
                        <div class="item">
                            <img src="images/user/2.png" />
                            <h2>王雪</h2>
                            <h3>Tel：18609005230</h3>
                            <p>具有十年1.5MW机组的运维技术支持经验，擅长整机运行数据的分析及故障处理指导.</p>
                        </div>
                        <div class="item">
                            <img src="images/user/3.png" />
                            <h2>余斌</h2>
                            <h3>Tel：13301152536</h3>
                            <p>5年机组装配和现场机组维护经验，目前从事技术支持工作，擅长处理机组变桨、水冷、机舱系统常规变量数据异常</p>
                        </div>
                    </div>
                </div>
                <div class="wrap">
                    <label>流程记录</label>
                    <div class="liucheng">
                        <div class="line"><i></i></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog jx_detail" id="jx_detail">
        <div class="opacity" style="z-index:9991;"></div>
        <div class="content" style="width:1000px;margin-left:-500px;z-index:9992;">
            <a class="close"></a>
            <h1></h1>
            <div class="scroll" style="height:650px;overflow:auto;padding-bottom:30px;">
                <table class="grid" border="0" cellpadding="0" cellspacing="0" style="margin-top:5px;border:0px;">
                    <thead>
                        <tr>
                            <td>预警时间</td>
                            <td>区域</td>
                            <td>风场</td>
                            <td>机组</td>
                            <td>隐患点</td>
                            <td>等级</td>
                            <td>处理方案</td>
                            <td>状态</td>
                            <td>流程</td>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <h1 style="text-align:center;margin-top:15px;">执行结果查看</h1>
                <div class="clearfix mt15" style="padding:0px 20px">
                    <div id="scroll_h" style="overflow:auto;">
                        <div style="white-space:nowrap;" class="clearfix">
                        </div>
                    </div>
                </div>
                <div class="d_zql clearfix">
                    <label>预警准确率</label>
                    <p><span></span></p>
                </div>
                <h1 style="text-align:center;margin:15px 20px 0;">结项备注</h1>
                <div style="margin:0px 20px;"><textarea class="remark" readonly="readonly"></textarea></div>

                <div class="btn">
                    <button type="button" class="cancle" for="jx_detail">关闭</button>
                    <button type="button" class="ml15 submitBtn">结项</button>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog jx_detail" id="jx_detail_form">
        <div class="opacity" style="z-index:9993;"></div>
        <div class="content" style="width:1000px;margin-left:-500px;z-index:9994;">
            <a class="close"></a>
            <h1>结项</h1>
            <div class="d_zql clearfix">
                <label>预警准确率</label>
                <p><span><a></a><a></a><a></a><a></a><a></a></span></p>
            </div>
            <h1 style="text-align:center;margin:15px 20px 0;">结项备注</h1>
            <div style="margin:0px 20px;"><textarea class="remark"></textarea></div>

            <div class="btn">
                <button type="button" class="cancle" onclick="$('#jx_detail_form').hide()">关闭</button>
                <button type="button" class="ml15 submitBtn">我要结项</button>
            </div>
        </div>
    </div>
	<script>
	var start = {
	  elem: '#begindate',
	  format: 'YYYY-MM-DD',
	  choose: function(datas){
		 end.min = datas; //开始日选好后，重置结束日的最小日期
		 end.start = datas //将结束日的初始值设定为开始日
	  }
	};
	var end = {
	  elem: '#enddate',
	  format: 'YYYY-MM-DD',
	  choose: function(datas){
		start.max = datas; //结束日选好后，重置开始日的最大日期
	  }
	};
	laydate(start);
	laydate(end);
	var pageLayer;
	$(function () {

	    var state = getQueryString("state");
	    if (state != "")
	    {
	        localStorage.setItem('keyone', 1);
			localStorage.setItem('keytwo', 1);
	        switch (state) {
	            case "1级":
	                $("#level input:eq(1)").addClass("active").siblings().removeClass("active");
	                break;
	            case "2级":
	                $("#level input:eq(2)").addClass("active").siblings().removeClass("active");
	                break;
	            case "3级":
	                $("#level input:eq(3)").addClass("active").siblings().removeClass("active");
	                break;
	            case "4级":
	                $("#level input:eq(4)").addClass("active").siblings().removeClass("active");
	                break;
	            case "5级":
	                $("#level input:eq(5)").addClass("active").siblings().removeClass("active");
	                break;
	            case "待审核":
	                $("#sh_status input:eq(1)").addClass("active").siblings().removeClass("active");
	                break;
	            case "新增预警":
	            case "已审核":
	            case "已派工":
	                $("#sh_status input:eq(3)").addClass("active").siblings().removeClass("active");
	                break;
                case "退回":
                    $("#sh_status input:eq(5)").addClass("active").siblings().removeClass("active");
                    break;
	            case "待派工":
                    $("#sh_status input:eq(2)").addClass("active").siblings().removeClass("active");
                    break;
	            case "已结项":
	                $("#sh_status input:eq(4)").addClass("active").siblings().removeClass("active");
	                break;
	        }
	    }

	    LoginJFPage(function () {
	        initYhd();
	        bindWF();
	        loadPage(1);
	    })

	    $(".search .tab input").click(function () {
	        if ($(this).hasClass("disabled"))
	            return;
	        $(this).addClass("active").siblings().removeClass("active");
	        if ($(this).parent().attr("id") == "cl_status") {
	            $("#sh_status input").removeClass("disabled").removeClass("active");

	            if ($(this).val() == "未处理") {
	                //禁用
	                $("#sh_status input:eq(1)").removeClass("disabled").siblings().addClass("disabled");
	            } else if ($(this).val() == "处理中") {
	                //禁用
	                $("#sh_status input:lt(2)").addClass("disabled");
	                $("#sh_status input:gt(3)").addClass("disabled");
	            } else if ($(this).val() == "处理完成") {
	                $("#sh_status input:lt(4)").addClass("disabled");
	            }
	        }
	    })

	    $(".search .right_btn button:eq(0)").click(function () {
	        //查询
	        $("#page").html('')
	        loadPage(1);
	    })

	    $(".search .right_btn button:eq(1)").click(function () {
	       //导出
	    })

	    $("#jx_detail_form .d_zql a").click(function () {
	        $("#jx_detail_form .d_zql a").removeClass("active");
	        $("#jx_detail_form .d_zql a").slice(0, $(this).index() + 1).addClass("active");
	    })

	    //工单详情 结项
	    $(".gd_detail h1 span:eq(0)").click(function () {
	        openjxDetail(currRow.index())
	    })

	    //工单详情 审核回退
	    $(".gd_detail h1 span:eq(1)").click(function () {
	        $("#dialog_1 .submitBtn").attr("alarmid", currPageJson.pagination.list[currRow.index()].alarmID);
	        $("#dialog_1").show();
	    })
        //开始派工
	    $(".gd_detail h1 span:eq(2)").click(function () {
	        var curIndex = currRow.index();
	        $("#dialog_3 .submitBtn").attr("alarmid", currPageJson.pagination.list[curIndex].alarmID);
	        //载入数据
	        $("#pg_yjTime").val(getjfLocalTime(currPageJson.pagination.list[curIndex].beginTime.time));
	        $("#pg_wfName").html('<option>' + currPageJson.pagination.list[curIndex].wfName + '</option>');
	        $("#pg_wtName").html('<option>' + currPageJson.pagination.list[curIndex].wtName + '</option>');
	        $("#pg_yhd").html('<option>' + currPageJson.pagination.list[curIndex].alarmName_CN + '</option>');
	        $("#pg_level").html('<option>' + currPageJson.pagination.list[curIndex].alarmGrade_CN + '</option>');
	        $("#pg_remark").val(currPageJson.pagination.list[curIndex].remark);
	        $("#pg_wtid").val(currPageJson.pagination.list[curIndex].wtID);
	        $("#pg_workID").val(CreateWorkID(currPageJson.pagination.list[curIndex].wtID));
	        switch (currPageJson.pagination.list[curIndex].dataType) {
	            case 1:
	                $("#pg_source").html('<option>巡检发现异常</option>');
	                break;
	            case 2:
	                $("#pg_source").html('<option>生产系统预警</option>');
	                break;
	            case 3:
	                $("#pg_source").html('<option>检测报告预警</option>');
	                break;
	            default:
	                $("#pg_source").html('<option>金风智能预警</option>');
	                break;
	        }
	        $("#dialog_3").show();
	    })
	})
	var currRow;
	function bindRowClick() {
	    $(".grid tr").on("dblclick", function (event) {
	        var _id = $(this).find("input[type='checkbox']").val();
	        $(this).find("input[type='checkbox']").get(0).checked = true;
	        currRow = $(this);
	        var Index = $(this).index();

	        if (currPageJson.pagination.list[Index].wfState == '2') {
	            $(".gd_detail h1 span:eq(1),.gd_detail h1 span:eq(2)").show();
	        } else {
	            $(".gd_detail h1 span:eq(1),.gd_detail h1 span:eq(2)").hide();
	        }
	        if (currPageJson.pagination.list[Index].wfState == '3') {
	            $(".gd_detail h1 span:eq(0)").show();
	        } else {
	            $(".gd_detail h1 span:eq(0)").hide();
	        }
	        //工单编号
	        var workID = currPageJson.pagination.list[Index].workID == undefined ? "派工后生成" : currPageJson.pagination.list[Index].workID;
	        $(".gd_detail h1 label").html('工单编号：' + workID);
	        switch (currPageJson.pagination.list[Index].wfState) {
	            case 1:
	                $(".gd_detail .wrap:eq(0) span:eq(0)").text('回退');
	                $(".gd_detail .wrap:eq(0) span:eq(1)").text('处理完成');
	                break;
	            case 2:
	                $(".gd_detail .wrap:eq(0) span:eq(0)").text('待派工');
	                $(".gd_detail .wrap:eq(0) span:eq(1)").text('处理中');
	                break;
	            case 3:
	                $(".gd_detail .wrap:eq(0) span:eq(0)").text('已派工');
	                $(".gd_detail .wrap:eq(0) span:eq(1)").text('处理中');
	                break;
	            case 4:
	                $(".gd_detail .wrap:eq(0) span:eq(0)").text('已结项');
	                $(".gd_detail .wrap:eq(0) span:eq(1)").text('处理完成');
	                break;
	            default:
	                $(".gd_detail .wrap:eq(0) span:eq(0)").text('待审核');
	                $(".gd_detail .wrap:eq(0) span:eq(1)").text('未处理');
	                break;
	        }
	        $(".gd_detail .wrap:eq(0) span:eq(2)").text(currPageJson.pagination.list[Index].alarmName_CN);
	        $(".gd_detail .wrap:eq(0) span:eq(3)").text(currPageJson.pagination.list[Index].alarmGrade_CN);
	        $(".gd_detail .wrap:eq(1) span:eq(0)").text(currPageJson.pagination.list[Index].proName);
	        $(".gd_detail .wrap:eq(1) span:eq(1)").text(currPageJson.pagination.list[Index].wfName);
	        $(".gd_detail .wrap:eq(1) span:eq(2)").text(currPageJson.pagination.list[Index].wtName);
	        
	        $(".gd_detail .wrap:eq(1) span:eq(3)").text(getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time));

	       
	        $(".gd_detail .wrap:eq(2) span:eq(0)").html(currPageJson.pagination.list[Index].proTime.time == undefined ? "&nbsp;" : getjfLocalTime(currPageJson.pagination.list[Index].proTime.time));

	        $(".gd_detail .wrap:eq(2) span:eq(1)").html("&nbsp;");

	        var isright = currPageJson.pagination.list[Index].isRight || 0;
	        switch (isright) {
	            case 1:
	            case 2:
	                $(".gd_detail .wrap:eq(2) span:eq(2) p").html('<a></a>');
	                break;
	            case 3:
	            case 4:
	                $(".gd_detail .wrap:eq(2) span:eq(2) p").html('<a></a><a></a>');
	                break;
	            case 5:
	            case 6:
	                $(".gd_detail .wrap:eq(2) span:eq(2) p").html('<a></a><a></a><a></a>');
	                break;
	            case 7:
	            case 8:
	                $(".gd_detail .wrap:eq(2) span:eq(2) p").html('<a></a><a></a><a></a><a></a>');
	                break;
	            case 9:
	            case 10:
	                $(".gd_detail .wrap:eq(2) span:eq(2) p").html('<a></a><a></a><a></a><a></a><a></a>');
	                break;
	            default:
	                $(".gd_detail .wrap:eq(2) span:eq(2) p").html('&nbsp;');
	                break;
	        }
	        $(".gd_detail .wrap:eq(3) .mul_text").text(currPageJson.pagination.list[Index].proContent == undefined ? "" : currPageJson.pagination.list[Index].proContent);

	        $(".liucheng .wrap").remove();

	        var messageType = currPageJson.pagination.list[Index].messageType;

	        if (messageType == 0)
	            $(".gd_detail .wrap:eq(4) .mul_text").html("&nbsp;");
	        else
	            $(".gd_detail .wrap:eq(4) .mul_text").text(currPageJson.pagination.list[Index].plan_CN);

	        //流程
	        if (currPageJson.pagination.list[Index].wfState == 2 || currPageJson.pagination.list[Index].wfState == 0) {
	            //预警
	            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">生成预警</label></div>');
	            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">推荐处理方案</label><div class="mul_text">' + currPageJson.pagination.list[Index].plan_CN + '</div></div>');
	            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label>SPHM收到预警</label></div>');

	        }
	        if (currPageJson.pagination.list[Index].wfState == 1) {
	            if (messageType == 1)
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">生成预警</label></div>');
	            else
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label>生成预警</label><div class="mul_text"><p>操作人：' + currPageJson.pagination.list[Index].publishUser + '</p><p>备注：' + (currPageJson.pagination.list[Index].proContent == undefined ? "" : currPageJson.pagination.list[Index].proContent) + '</p></div></div>');

	            if (messageType == 1)
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">推荐处理方案</label><div class="mul_text">' + currPageJson.pagination.list[Index].plan_CN + '</div></div>');
	            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label>SPHM收到预警</label></div>');

	            var index = layer.msg('数据获取中...', { icon: 16, shade: 0.01, time: 999999 });
	            $.ajax({
	                type: "post",
	                url: window.JFApiDomian + '/alarmInfo_getAlarmFallback.do?alarmID=' + currPageJson.pagination.list[Index].alarmID,
	                cache: false,
	                dataType: 'jsonp',
	                xhrFields: {
	                    withCredentials: true
	                },
	                crossDomain: true,
	                complete: function () {
	                    layer.close(index)
	                },
	                success: function (json) {
	                    //审核回退
	                    $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].verifyTime.time) + '</label> <label>审核回退</label><div class="mul_text"><p>操作时间：' + getjfLocalTime(json.listData[0].addTime.time) + '</p><p>操作人：' + json.listData[0].sender + '</p><p>备注：' + (json.listData[0].reason == undefined ? "无" : json.listData[0].reason) + '</p></div></div>');
	                },
	                error: function () {
	                    alert('载入数据失败！');
	                }
	            });
	        }

	        //已派工
	        if (currPageJson.pagination.list[Index].wfState == 3) {

	            if (messageType == 1)
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">生成预警</label></div>');
	            else
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label>生成预警</label><div class="mul_text"><p>操作人：' + currPageJson.pagination.list[Index].publishUser + '</p><p>备注：' + (currPageJson.pagination.list[Index].proContent == undefined ? "" : currPageJson.pagination.list[Index].proContent) + '</p></div></div>');

	            if (messageType == 1)
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">推荐处理方案</label><div class="mul_text">' + currPageJson.pagination.list[Index].plan_CN + '</div></div>');
	            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label>SPHM收到预警</label></div>');

	            var index = layer.msg('数据获取中...', { icon: 16, shade: 0.01, time: 999999 });
	            //获取派工的基本信息
	            $.ajax({
	                type: "post",
	                url: window.JFApiDomian + '/alarmInfo_getAlarmWork.do?customAlarmID=' + currPageJson.pagination.list[Index].customAlarmID,
	                cache: false,
	                dataType: 'jsonp',
	                xhrFields: {
	                    withCredentials: true
	                },
	                crossDomain: true,
	                success: function (json) {
	                    var workHtml = '';
	                    for (var i = 0; i < json.listData[0].works.length; i++) {
	                        if (i == 0)
	                            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(json.listData[0].works[i].proTime.time) + '</label> <label>开始派工</label><div class="mul_text"><p>预警工单编号：' + json.listData[0].works[i].workID + '</p><p>操作人：' + (messageType == 1 ? "自动生成" : currPageJson.pagination.list[Index].publishUser) + '</p><p>备注：' + (json.listData[0].works[i].proContent == undefined ? "无" : json.listData[0].works[i].proContent) + '</p></div></div>');
	                        else {
	                            if (i == 1)
	                                workHtml = '<div class="wrap"><i></i><label>&nbsp;</label> <label>执行单记录</label>';

	                            workHtml += '<div class="mul_text">'
	                            workHtml += '<p>执行单ID：' + json.listData[0].works[i].workID + '</p>'
	                            workHtml += '<p>创建时间：' + getjfLocalTime(json.listData[0].works[i].addTime.time) + '</p>'
	                            workHtml += '<p>创建人：' + json.listData[0].works[i].adder + '</p>'
	                            workHtml += '<p>处理人：' + json.listData[0].works[i].proer + '</p>'
	                            workHtml += '<p>备注：' + (json.listData[0].works[i].proContent == undefined ? "无" : json.listData[0].works[i].proContent) + '</p>'

	                            var isRight = json.listData[0].works[i].isRight || 0;

	                            workHtml += '<p>准确率判断：' + (isRight == 1 ? "准确":"不准确") + '</p>'

	                            
	                            //获取部件
	                            var bjdetail = '';
	                            for (var j = 0; j < json.listData[0].parts.length; j++) {
	                                if (json.listData[0].parts[j].workID == json.listData[0].works[i].workID && json.listData[0].parts[j].customAlarmID == currPageJson.pagination.list[Index].customAlarmID) {
	                                    bjdetail += '<p>部件名称：' + json.listData[0].parts[j].partName + ' X ' + json.listData[0].parts[j].partNum + '</p>';
	                                }
	                            }
	                            if (bjdetail == '') {
	                                workHtml += '<p>是否更换部件：否</p>';
	                            } else
	                                workHtml += '<p>是否更换部件：是</p>';

	                            workHtml += bjdetail;

	                            workHtml += '</div>';

	                            //列出执行单
	                            if (i == json.listData[0].works.length - 1)
	                                workHtml += '</div>';
	                        }
	                    }

	                    $(".liucheng").append(workHtml);

	                    if (json.listData[0].works.length > 1) {
	                        $(".gd_detail .wrap:eq(2) span:eq(1)").html(currPageJson.pagination.list[Index].customAlarmID == null ? "&nbsp;" : ('<a class="blue" onclick="openjxDetail(' + Index + ')">查看结果</a>'));
	                    }
	                    layer.close(index);
	                },
	                error: function () {
	                    layer.close(index);
	                    alert('载入数据失败！');
	                }
	            });
	        }

	        //已结项
	        if (currPageJson.pagination.list[Index].wfState == 4) {
	            if (messageType == 1)
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">生成预警</label></div>');
	            else
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label>生成预警</label><div class="mul_text"><p>操作人：' + currPageJson.pagination.list[Index].publishUser + '</p><p>备注：' + (currPageJson.pagination.list[Index].proContent == undefined ? "" : currPageJson.pagination.list[Index].proContent) + '</p></div></div>');

	            if (messageType == 1)
	                $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label class="yellow">推荐处理方案</label><div class="mul_text">' + currPageJson.pagination.list[Index].plan_CN + '</div></div>');
	            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].beginTime.time) + '</label> <label>SPHM收到预警</label></div>');

	            var index = layer.msg('数据获取中...', { icon: 16, shade: 0.01, time: 999999 });
	            //获取派工的基本信息
	            $.ajax({
	                type: "post",
	                url: window.JFApiDomian + '/alarmInfo_getAlarmWork.do?customAlarmID=' + currPageJson.pagination.list[Index].customAlarmID,
	                cache: false,
	                dataType: 'jsonp',
	                xhrFields: {
	                    withCredentials: true
	                },
	                crossDomain: true,
	                success: function (json) {
	                    var workHtml = '';
	                    for (var i = 0; i < json.listData[0].works.length; i++) {
	                        if (i == 0)
	                            $(".liucheng").append('<div class="wrap"><i></i><label>' + getjfLocalTime(json.listData[0].works[i].proTime.time) + '</label> <label>开始派工</label><div class="mul_text"><p>预警工单编号：' + json.listData[0].works[i].workID + '</p><p>操作人：' + (messageType == 1 ? "自动生成" : currPageJson.pagination.list[Index].publishUser) + '</p><p>备注：' + (json.listData[0].works[i].proContent == undefined ? "无" : json.listData[0].works[i].proContent) + '</p></div></div>');
	                        else {
	                            if (i == 1)
	                                workHtml = '<div class="wrap"><i></i><label>&nbsp;</label> <label>执行单记录</label>';

	                            workHtml += '<div class="mul_text">'
	                            workHtml += '<p>执行单ID：' + json.listData[0].works[i].workID + '</p>'
	                            workHtml += '<p>创建时间：' + getjfLocalTime(json.listData[0].works[i].addTime.time) + '</p>'
	                            workHtml += '<p>创建人：' + json.listData[0].works[i].adder + '</p>'
	                            workHtml += '<p>处理人：' + json.listData[0].works[i].proer + '</p>'
	                            workHtml += '<p>备注：' + (json.listData[0].works[i].proContent == undefined ? "无" : json.listData[0].works[i].proContent) + '</p>'
	                            var isRight = json.listData[0].works[i].isRight || 0;

	                            workHtml += '<p>准确率判断：' + (isRight == 1 ? "准确" : "不准确") + '</p>'
	                            var bjdetail = '';
	                            //获取部件
	                            for (var j = 0; j < json.listData[0].parts.length; j++) {
	                                if (json.listData[0].parts[j].workID == json.listData[0].works[i].workID && json.listData[0].parts[j].customAlarmID == currPageJson.pagination.list[Index].customAlarmID) {
	                                    bjdetail += '<p>部件名称：' + json.listData[0].parts[j].partName + ' X ' + json.listData[0].parts[j].partNum + '</p>';
	                                }
	                            }
	                            if (bjdetail == '') {
	                                workHtml += '<p>是否更换部件：否</p>';
	                            } else
	                                workHtml += '<p>是否更换部件：是</p>';

	                            workHtml += bjdetail;
	                            workHtml += '</div>';
	                            //列出执行单
	                            if (i == json.listData[0].works.length - 1)
	                                workHtml += '</div>';
	                        }
	                    }

	                    $(".liucheng").append(workHtml);
	                    $(".gd_detail .wrap:eq(2) span:eq(1)").html(currPageJson.pagination.list[Index].customAlarmID == null ? "&nbsp;" : ('<a class="blue" onclick="openjxDetail(' + Index + ')">查看结果</a>'));

	                    var html = '<div class="wrap"><i></i><label>' + getjfLocalTime(currPageJson.pagination.list[Index].overTime.time) + '</label> <label>完成结项</label><div class="mul_text"><p>结项时间：' + getjfLocalTime(currPageJson.pagination.list[Index].overTime.time)
                            + '</p><p>操作人：' + currPageJson.pagination.list[Index].overUser + '</p><p>预警准确率：';

	                    //var isright = currPageJson.pagination.list[Index].isRight || 0;
	                    switch (isright) {
	                        case 1:
	                        case 2:
	                            html += '1星';
	                            break;
	                        case 3:
	                        case 4:
	                            html += '2星';
	                            break;
	                        case 5:
	                        case 6:
	                            html += '3星';
	                            break;
	                        case 7:
	                        case 8:
	                            html += '4星';
	                            break;
	                        case 9:
	                        case 10:
	                            html += '5星';
	                            break;
	                        default:
	                            html += '&nbsp;';
	                            break;
	                    }

	                    html += '</p><p>备注：' + (currPageJson.pagination.list[Index].remark == undefined ? "无" : currPageJson.pagination.list[Index].remark) + '</p></div></div>';

	                    $(".liucheng").append(html);
	                    layer.close(index);
	                },
	                error: function () {
	                    layer.close(index);
	                    alert('载入数据失败！');
	                }
	            });
	        }


	        $(".gd_detail").show();
	        event.stopPropagation();
	    })
    }

    //隐患点
	function initYhd() {
	    var index = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 9999999999 });
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_getAlarmFileLevel.action',
	        cache: false,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        complete: function () {
	            layer.close(index);
	        },
	        success: function (json) {
	            for (var o in json.listData) {
	                $("#yhd").append('<option value="' + json.listData[o].ruleID + '">' + json.listData[o].alarmName_CN + '</option>');
	            }
	        },
	        error: function () {
	            alert('载入数据失败！');
	        }
	    });
	}

	function bindWF() {
	    var lay = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });

	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_getWfName.do',
	        cache: false,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        complete: function () {
	            layer.close(lay);
	        },
	        success: function (json) {
	            for (var o in json.listData) {
	                $("#wfName").append('<option value="' + json.listData[o].wfid + '">' + json.listData[o].wfName + '</option>');
	            }
	        },
	        error: function () {
	            alert('载入数据失败！');
	        }
	    });
	}

	function bindWT() {
	    var lay = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_getWtIDOrName.do?wfID=' + $("#wfName").val()+"&userId="+userId,
	        cache: false,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        complete: function () {
	            layer.close(lay);
	        },
	        success: function (json) {
	            $("#wtName").html('');
	            $("#wtName").append('<option value="">请选择</option>');
	            for (var i = 0; i < json.listData.length; i++) {
	                $("#wtName").append('<option value="' + json.listData[i].wtID + '">' + json.listData[i].wtName + '</option>');
	            }

	        },
	        error: function () {
	            alert('载入数据失败！');
	        }
	    });
	}
	var currPageJson;
	function loadPage(pageIndex) {
	    pageLayer = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_searchWorkPub.do?pageid=' + pageIndex + '&pagecount=18&userId='+userId + getSearchFilter(),
	        cache: false,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        success: function (json) {
	            if (json.state == 1 && json.pagination.pageNo == pageIndex) {
	                $(".grid tbody tr").remove();
	                currPageJson = json;
	                var jsonList = json.pagination.list;
	                var html = '';
	                var lc = '';
	                var messageType;
	                for (var o in jsonList) {
	                    messageType = jsonList[o].messageType;

	                    html = '<tr><td><input type="checkbox" value="' + jsonList[o].customAlarmID + '" class="chk" name="chk" /></td>'
	                    html += '<td>' + getjfLocalTime(jsonList[o].beginTime.time) + '</td><td>' + jsonList[o].proName + '</td><td>' + jsonList[o].wfName + '</td><td>' + jsonList[o].wtName + '</td>'
	                    html += '<td>' + jsonList[o].alarmName_CN + '</td><td>' + jsonList[o].alarmGrade_CN + '</td><td title="' + (messageType == 1 ? jsonList[o].plan_CN : "") + '">' + (messageType == 1 ? sb_substr(jsonList[o].plan_CN, 0, 30) : "") + '</td>'
	                    html += '<td>';
	                    lc = '';
	                    switch (jsonList[o].wfState) {
	                        case 0:
	                            html += '待审核';
	                            lc = '未处理';
	                            break;
	                        case 1:
	                            html += '回退';
	                            lc = '处理完成';
	                            break;
	                        case 2:
	                            html += '待派工';
	                            lc = '处理中';
	                            break;
	                        case 3:
	                            html += '已派工';
	                            lc = '处理中';
	                            break;
	                        case 4:
	                            html += '结项';
	                            lc = '处理完成';
	                            break;
	                        default:
	                            html += '&nbsp;';
	                            break;
	                    }
	                    html += '</td><td>' + lc + '</td><td>';
	                    switch (jsonList[o].isRight) {
	                        case 1:
	                        case 2:
	                        case 3:
	                        case 4:
	                            html += '不准确';
	                            break;
	                        case 5:
	                        case 6:
	                        case 7:
	                        case 8:
	                        case 9:
	                        case 10:
	                            html += '准确';
	                            break;
	                        default:
	                            html += '&nbsp;';
	                            break;
	                    }
	                    html += '</td><td>' + jsonList[o].customAlarmID + '</td></tr>';

	                    $(".grid tbody").append(html);
	                }
	                bindRowBgColor();
	                bindRowClick();
	                if ($("#page").text() == '') {
	                    $("#page").Page({
	                        totalPages: json.pagination.totalPage,
	                        liNums: 7,
	                        activeClass: 'activP',
	                        callBack: function (page) {
	                            pageLayer = layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
	                            loadPage(page)
	                        }
	                    });
	                }
	            }
	            layer.close(pageLayer);
	        },
	        error: function () {
	            alert('载入数据失败！');
	        }
	    });
	}

	function getSearchFilter() {
        var filter = '';
        //工作编号
        if ($.trim($('#workcode').val()) != '')
            filter += '&workId=' + $.trim($('#workcode').val());
        if ($.trim($('#zxdcode').val()) != '')
            filter += '&customAlarmId=' + $.trim($('#zxdcode').val());
        //审核状态
        if ($("#sh_status .active").attr('key') != undefined) {
            filter += '&wfState=' + $("#sh_status .active").attr('key');
        } 
        
        //预警时间
        if ($('#begindate').val() != '') {
            filter += '&beginTime=' + $('#begindate').val();
        }
        if ($('#enddate').val() != '') {
            filter += '&endTime=' + $('#enddate').val();
        }
        if ($('#begindate').val() == '' && $('#enddate').val() == '') {
            var begindate = '', enddate = '';
            switch ($("#yj_time .active").val()) {
                case '今天':
                    begindate = enddate = getDay();
                    break;
                case '昨天':
                    begindate = enddate = GetDateStr(-1);
                    break;
                case '近一周':
                    begindate = GetDateStr(-6);
                    enddate = getDay();
                    break;
                case '本月':
                    begindate = GetYear() + "-" + GetMonth() + "-01";
                    enddate = GetYear() + "-" + GetMonth() + "-"+getLastDay(GetYear(),GetMonth());
                    break;
                case '本年':
                    begindate = GetYear() + "-01-01";
                    enddate = GetYear() + "-12-" + getLastDay(GetYear(), 12);
                    break;
            }
            if(begindate != '' && enddate != '')
                filter += '&beginTime=' + begindate + ' 00:00:00&endTime=' + enddate+' 23:59:59';
        }
        if ($("#level .active").attr('key') != undefined) {
            filter += '&alarmGrade_EN=' + $("#level .active").attr('key');
        }
        //预警来源
        if ($("#yj_source").val() != '') {
            filter += '&dataType=' + $("#yj_source").val();
        } 
        //隐患点
        if ($("#yhd").val() != '') {
            filter += '&ruleID=' + $("#yhd").val();
        }
        //风场
        if ($("#wfName").val() != '') {
            filter += '&wfID=' + $("#wfName").val();
        }
        if ($("#wtName").val() != '') {
            filter += '&wtID=' + $("#wtName").val();
        }
        //准确度
        if ($("#zqd .active").attr('key') != undefined) {
            filter += '&isRight=' + $("#zqd .active").attr('key');
        }
        return filter;
	}

	function getSphmTime(alarmID) {

	    var index = layer.msg('数据获取中...', { icon: 16, shade: 0.01, time: 999999 });
	    //获取SPHM收到预警时间
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_getAlarmMsg.do?alarmID=' + alarmID,
	        cache: false,
	        async: true,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        complete: function () {
	            layer.close(index);
	        },
	        success: function (json) {
	            if (json.listData.length > 0) {
	                return '无';
	            }
	            return '无';
	        },
	        error: function () {
	            alert('载入数据失败！');
	        }
	    });
	}

	//审核回退
	function huitui(from) {
	    var _id = $("#dialog_1 .submitBtn").attr('alarmid');
	    if (!Validator.Validate(document.getElementById('ht_form'))) return false;

	    var data = 'alarmID=' + _id + '&wfState=1&reson=' + $("#reason").val() + '&remark=' + $("#ht_remark").val();

	    var load = layer.msg('数据提交中...', { icon: 16, shade: 0.01, time: 999999 });
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_callBack.do',
	        cache: false,
	        data: data,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        complete: function () {
	            layer.close(load);
	        },
	        success: function (json) {
	            layer.msg(json.message, { time: 1000 }, function () {
	                $("#dialog_1").hide();
	                if (json.state == 1) {
	                    $("#ht_form").get(0).reset();
	                    loadPage(parseInt($("#page a.activP").text()));
	                }
	            });
	        },
	        error: function () {
	            alert('数据提交失败！');
	        }
	    });
	}

	//开始派工
	function paigong(from) {
	    var _id = $("#dialog_3 .submitBtn").attr('alarmid');
	    if (!Validator.Validate(document.getElementById('pg_form'))) return false;

	    var data = 'alarmID=' + _id + '&workID=' + $("#pg_workID").val() + '&wfState=3&remark=' + $("#pg_remark").val() + "&adder=" + userId + "&proer=" + userId;

	    var load = layer.msg('数据提交中...', { icon: 16, shade: 0.01, time: 999999 });
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_dispatchWork.do',
	        cache: false,
	        data: data,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        complete: function () {
	            layer.close(load);
	        },
	        success: function (json) {
	            layer.msg(json.message, { time: 1000 }, function () {
	                $("#dialog_3").hide();
	                if (json.state == 1) {
	                    //清空表单
	                    $("#pg_form").get(0).reset();
	                    loadPage(parseInt($("#page a.activP").text()));
	                } else {
	                    //重新生成
	                    $("#pg_workID").val(CreateWorkID($("#pg_wtid").val()));
	                }
	            });
	        },
	        error: function () {
	            alert('数据提交失败！');
	        }
	    });
	}

	function jx_layer() {
	    $('#jx_detail_form .d_zql a').removeClass("active");
	    $("#jx_detail_form textarea").val('');
	    $('#jx_detail_form').show();
	}

	$('#jx_detail_form .submitBtn').click(function () {
	    //获取星
	    var isRight = $('#jx_detail_form .d_zql a.active').length * 2;
	    var remark = $("#jx_detail_form textarea").val();
	    var lay = layer.msg('结项提交中...', { icon: 16, shade: 0.01, time: 999999 });

	    //提交结项
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_setOverAlarm.do?alarmID=' + currPageJson.pagination.list[currRow.index()].alarmID + '&overUser=' + userId + "&wfState=4&isRight=" + isRight + "&remark=" + remark,
	        cache: false,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        complete: function () {
	            layer.close(lay);
	        },
	        success: function (json) {
	            layer.msg(json.message, { time: 1000 }, function () {
	                if (json.state == 1) {
	                    $(".dialog").hide();
	                    loadPage(parseInt($("#page a.activP").text()));
	                }
	            });
	        },
	        error: function () {
	            alert('载入数据失败！');
	        }
	    });
	})

	function openjxDetail(index) {
	    var state = '';
	    var lc = '';
	    $("#jx_detail .submitBtn").unbind("click");
	    $("#jx_detail .submitBtn").text("结项");
	    switch (currPageJson.pagination.list[index].wfState) {
	        case 1:
	            state = "回退";
	            lc = "处理完成";
	            break;
	        case 2:
	            state = "待派工";
	            lc = "处理中";
	            break;
	        case 3:
	            state = "已派工";
	            lc = "处理中";
	            //绑定结项
	            $("#jx_detail .submitBtn").click(function () {
	                jx_layer();
	            })
	            break;
	        case 4:
	            state = "已结项";
	            lc = "处理完成";
	            $("#jx_detail .submitBtn").text("已结项");
	            break;
	        default:
	            state = "待审核";
	            lc = "未处理";
	            break;
	    }

	    $("#jx_detail .grid tbody").html("<tr><td>" + getjfLocalTime(currPageJson.pagination.list[index].beginTime.time) + "</td><td>" + currPageJson.pagination.list[index].proName + "</td><td>"
                + sb_substr(currPageJson.pagination.list[index].wfName,0,16) + "</td><td>" + currPageJson.pagination.list[index].wtName
                + "</td><td>" + currPageJson.pagination.list[index].alarmName_CN + "</td><td>" + currPageJson.pagination.list[index].alarmGrade_CN
                 + "</td><td>" + sb_substr(currPageJson.pagination.list[index].plan_CN, 0, 20) + "</td><td>" + state + "</td><td>" + lc + "</td></tr>")

	    //结项信息
	    if (currPageJson.pagination.list[index].wfState == 4) {

	        var isRight = currPageJson.pagination.list[index].isRight || 0;
			$("#jx_detail .d_zql span").html('');
	        if (isRight != 0) {
	            for(var i = 0; i < isRight;i=i+2)
	                $("#jx_detail .d_zql span").append("<a class='active'></a>");
	        }
	        $("#jx_detail textarea").val(currPageJson.pagination.list[index].remark);
	    }


	    //显示相关信息
	    layer.msg('数据载入中...', { icon: 16, shade: 0.01, time: 999999 });
	    $("#scroll_h div").html('');
	    $.ajax({
	        type: "post",
	        url: window.JFApiDomian + '/alarmInfo_getAlarmWork.do?customAlarmID=' + currPageJson.pagination.list[index].customAlarmID,
	        cache: false,
	        dataType: 'jsonp',
	        xhrFields: {
	            withCredentials: true
	        },
	        crossDomain: true,
	        success: function (json) {
	            var html, bjhtml, isBj, isRight;
	            for (var i = 1; i < json.listData[0].works.length; i++) {
	                isBj = false;

	                html = '<div class="left_result"><h1>执行结果记录单_' + i + '</h1>';
	                html += '<dl class="clearfix"><dt>执行单ID</dt><dd><input type="text" value="' + json.listData[0].works[i].workID + '" class="txt" readonly></dd></dl>';
	                html += '<dl class="clearfix"><dt>创建时间</dt><dd><input type="text" value="' + getjfLocalTime(json.listData[0].works[i].addTime.time) + '" class="txt" readonly></dd></dl>';
	                html += '<dl class="clearfix"><dt>创建人</dt><dd><input type="text" value="' + json.listData[0].works[i].adder + '" class="txt" readonly></dd></dl>';
	                html += '<dl class="clearfix"><dt>处理人</dt><dd><input type="text" value="' + json.listData[0].works[i].proer + '" class="txt" readonly></dd></dl>';
	                html += '<dl class="clearfix"><dt>处理时间</dt><dd><input type="text" value="' + getjfLocalTime(json.listData[0].works[i].proTime.time) + '" class="txt" readonly></dd></dl>';
	               
	                isRight = json.listData[0].works[i].isRight || 0;
	                if (isRight == 0)
	                    html += '<dl class="clearfix"><dt>准确率判断</dt><dd>不准确</dd></dl>';
	                else
	                    html += '<dl class="clearfix"><dt>准确率判断</dt><dd>准确</dd></dl>';
	                html += '<dl class="clearfix"><dt>备注</dt><dd><textarea name="remark" readonly="readonly" value="' + (json.listData[0].works[i].proContent == undefined ? "" : json.listData[0].works[i].proContent) + '"></textarea></dd></dl>';

	                bjhtml = '<div style="overflow:auto;height:100px;"><table cellpadding="0" cellspacing="0" border="0"><tr><td>备件名称</td><td>数量</td></tr>';

	                //获取部件
	                for (var j = 0; j < json.listData[0].parts.length; j++) {
	                    if (json.listData[0].parts[j].workID == json.listData[0].works[i].workID && json.listData[0].parts[j].customAlarmID == currPageJson.pagination.list[Index].customAlarmID) {
	                        isBj = true;
	                        bjhtml += '<tr><td>' + json.listData[0].parts[j].partName + '</td><td>' + json.listData[0].parts[j].partNum + '</td></tr>';
	                    }
	                }

	                bjhtml += '</table></div>';

	                if (isBj == true)
	                    html += '<dl class="clearfix"><dt>是否更换部件</dt><dd>是</dd></dl>';
	                else
	                    html += '<dl class="clearfix"><dt>是否更换部件</dt><dd>否</dd></dl>';

	                html += bjhtml;
	                html += '</div>';

	                $("#scroll_h > div").append(html);
	            }

	            $("#scroll_h .clearfix:eq(0)").css("width", (json.listData[0].works.length-1) * 460 + (json.listData[0].works.length-1) * 10);
	            layer.closeAll();
	        },
	        error: function () {
	            layer.closeAll();
	            alert('载入数据失败！');
	        }
	    });

	    $("#jx_detail").show();
	}
	</script>
</body>
</html>